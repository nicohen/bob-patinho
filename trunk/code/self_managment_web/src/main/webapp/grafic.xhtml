<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:a4j="http://richfaces.org/a4j"
	xmlns:rich="http://richfaces.org/rich">

<head>
<link rel="stylesheet" type="text/css"
	href="style/self_managment_web.css" />
</head>

<ui:composition template="/template.xhtml">
	<ui:define name="body">

		<f:view>
			<f:loadBundle basename="messages" var="msg" />
			
			<h:form id="graphicForm">

				<rich:dataTable rendered="false" />
				
				<rich:calendar id="period" showWeekDaysBar="false" showFooter="false" value="#{graficBean.currentPeriod}"
 					oncurrentdateselected="event.rich.component.selectDate(event.rich.date)"
 					popup="false" styleClass="special">
 					<a4j:support action="#{graficBean.periodChange}" event="onchanged" reRender="mainData, metricValues, grafic"/>
 				</rich:calendar>
 				
				<h:panelGrid id="mainData" columns="4" width="80%">

					<h:outputText value="#{msg['label.agent.name']}:" />
					<h:outputText value="#{graficBean.currentAgent.surname}, #{graficBean.currentAgent.name}" />

					<h:outputText value="Fecha: " />
					<h:outputText value="#{graficBean.today}" />

					<h:outputText value="#{msg['label.campaign']}:" />
					<h:outputText value="#{graficBean.currentAgent.campaign.name}" />

					<h:outputText value="#{msg['label.agent.grossSalary']}:" />
					<h:outputText value="$ #{graficBean.sueldoFijo}" />

					<h:outputText value="#{msg['label.agent.variableSalary']}:" />
					<h:outputText value="$ #{graficBean.variableSalary}" />

					<h:outputText value="Sueldo Variable Proyectado:" />
					<h:outputText value="$ #{graficBean.sueldoVariableProyectado}" />

					<h:outputText value="#{msg['label.agent.overtimeSalary']}:" />
					<h:outputText value="#{graficBean.sueldoHorasExtra}" />

					<h:outputText value="Sueldo Total Proyectado:" />
					<h:outputText value="$ #{graficBean.sueldoTotalProyectado}" />

				</h:panelGrid>
				<br />
				<br />
				
				<h:panelGrid columns="2" border="4" style="text-align:center" columnClasses="alignTop, alignTop">				
					<h:panelGroup>	
						<table border="1" class="dr-table rich-table">
							<thead class="dr-table-thead">
								<tr class="dr-table-header rich-table-header">
									<th class="dr-table-headercell rich-table-headercell">
										<h:outputText value="Nivel de Logro" />
									</th>
									<th class="dr-table-headercell rich-table-headercell">
										<h:outputText value="#{msg['label.metric.optim']}" />
									</th>
									<th class="dr-table-headercell rich-table-headercell">
										<h:outputText value="#{msg['label.metric.objective']}" />
									</th>
									<th class="dr-table-headercell rich-table-headercell">
										<h:outputText value="#{msg['label.metric.minimum']}" />
									</th>
									<th class="dr-table-headercell rich-table-headercell">
										<h:outputText value="#{msg['label.metric.unsatisfactory']}" />
									</th>
								</tr>
							</thead>
							<tbody>
								<a4j:repeat value="#{graficBean.metrics}" var="metric">
									<tr>
										<td align="center" class="dr-subtable-cell rich-subtable-cell">
											<h:outputText value="#{metric.pk.metric}" />
										</td>
										<td align="center" class="dr-subtable-cell rich-subtable-cell">
											<h:outputText value="#{metric.pk.metric.optimSign} #{metric.optim} #{metric.pk.metric.unit}" />
										</td>
										<td align="center" class="dr-subtable-cell rich-subtable-cell">
											<h:outputText value="#{metric.pk.metric.objetiveSign} #{metric.objective} #{metric.pk.metric.unit}" />
										</td>
										<td align="center" class="dr-subtable-cell rich-subtable-cell">
											<h:outputText value="#{metric.pk.metric.minimumSign} #{metric.minimum} #{metric.pk.metric.unit}" />
										</td>
										<td align="center" class="dr-subtable-cell rich-subtable-cell">
											<h:outputText value="#{metric.pk.metric.unsatisfactorySign} #{metric.unsatisfactory} #{metric.pk.metric.unit}" />
										</td>
									</tr>
								</a4j:repeat>
								<tr>
									<td colspan="5" align="center">
										<h:outputText value="Valor Hora ($)"/>
									</td>
								</tr>
								<tr>
									<td/>
									<td align="center" class="dr-subtable-cell rich-subtable-cell" style="background-color:green">
										<h:outputText value="#{graficBean.currentAgent.campaign.optimValue}" />
									</td>
									<td align="center" class="dr-subtable-cell rich-subtable-cell" style="background-color:yellow">
										<h:outputText value="#{graficBean.currentAgent.campaign.objetiveValue}" />
									</td>
									<td align="center" class="dr-subtable-cell rich-subtable-cell" style="background-color:orange">
										<h:outputText value="#{graficBean.currentAgent.campaign.minimumValue}" />
									</td>
									<td align="center" class="dr-subtable-cell rich-subtable-cell" style="background-color:red">
										<h:outputText value="#{graficBean.currentAgent.campaign.unsatisfactoryValue}" />
									</td>
								</tr>
							</tbody>
						</table>
					</h:panelGroup>
					
					<h:panelGroup id="metricValues">
						<table border="1" class="dr-table rich-table">
							<thead class="dr-table-thead">
								<tr class="dr-table-header rich-table-header">
									<th class="dr-table-headercell rich-table-headercell">
										<h:outputText value="#{msg['label.metric']}" />
									</th>
									<th class="dr-table-headercell rich-table-headercell">
										<h:outputText value="Fecha actual" />
									</th>
									<th class="dr-table-headercell rich-table-headercell">
										<h:outputText value="Proyectado" />
									</th>
								</tr>
							</thead>
							<tbody>
								<a4j:repeat value="#{graficBean.metrics}" var="metric">
									<tr>
										<td align="center" class="dr-subtable-cell rich-subtable-cell">
											<h:outputText value="#{metric.pk.metric}" />
										</td>
										<td align="center" class="dr-subtable-cell rich-subtable-cell">
											<h:outputText binding="#{graficBean.metricOutput}"
												value="#{graficBean.metricValue}">
												<f:attribute name="metric" value="#{metric}" />
											</h:outputText>
										</td>
										<td align="center" class="dr-subtable-cell rich-subtable-cell">
											<h:outputText value="1" />
										</td>
									</tr>
								</a4j:repeat>
							</tbody>
						</table>
					</h:panelGroup>
				</h:panelGrid>

				<br />
				
				<h:panelGrid id="grafic" columns="1">
					<h:panelGroup>				
						<rich:comboBox id="cboMetric" 
							value="#{graficBean.selectedMetricToDraw}"
							size="25"
							converter="com.self_managment.web.converter.CampaignMetricConverter">
							<a4j:support event="onselect" reRender="img"/>
							<f:selectItems value="#{graficBean.metricsCombo}" />							
						</rich:comboBox>
					</h:panelGroup>

					<a4j:mediaOutput id="img" element="img" cacheable="false" session="false"
						createContent="#{graficBean.generaGrafico}"
						value="#{graficBean.selectedMetricToDraw}" mimeType="image/jpeg">
						<f:param value="#{graficBean.timeStamp}" name="time" />
					</a4j:mediaOutput>
					
				</h:panelGrid>
			</h:form>

			<a4j:status id="status" onstart="#{rich:component('wait')}.show()"
				onstop="#{rich:component('wait')}.hide()" />


			<rich:modalPanel id="wait" autosized="true" width="32" height="32"
				moveable="false" resizeable="false">
				<h:graphicImage value="/images/Busy-icon.gif" />
			</rich:modalPanel>
		</f:view>

	</ui:define>
</ui:composition>
</html>